(this["webpackJsonpxmpp-test"]=this["webpackJsonpxmpp-test"]||[]).push([[0],{258:function(e,t,n){},269:function(e,t){},324:function(e,t){},326:function(e,t){},333:function(e,t,n){"use strict";n.r(t);var c=n(0),r=n.n(c),a=n(74),s=n.n(a),o=n(6),i=n(18),u=n(27),l=n(9),j=n(4),d=n.n(j),b=n(36),O=n(215),f=n(207),p=n(216),m=n(277),h=n(433),x=n(431),v=n(442),g=n(443),w=n(419),k=n(444),y=n(445),S=n(435),C=(n(258),n(409)),A=n(429),I=n(1),R=function(e){var t=e.loading,n=e.username,c=e.onChangeUsername,r=e.password,a=e.onChangePassword,s=e.error,o=e.signIn;return Object(I.jsxs)(C.a,{spacing:3,sx:{width:"400px",maxWidth:"100%",my:3,mx:"auto"},children:[Object(I.jsx)(A.a,{label:"Username",disabled:t,onChange:c,value:n,error:!!s}),Object(I.jsx)(A.a,{label:"Password",disabled:t,onKeyDown:function(e){return"Enter"===e.key&&o()},type:"password",onChange:a,value:r,error:!!s,helperText:s&&"Invalid credentials"}),Object(I.jsx)(S.a,{variant:"contained",disabled:t,onClick:o,children:" Sign in "})]})},P=n(428),_=n(438),M=n(440),U=n(218),T=n(441),E=n(439),z=n(434),N=n(420),D=n(446),G=n(436),L=n(421),B=n(159),H=n.n(B),F=n(203),W=n.n(F),K=n(418),J=n(199),Y=n.n(J),q=n(198),Q=n.n(q),V=n(202),X=n.n(V),Z=n(80),$=function(e){var t=e.message,n=e.client,c=(e.isRoom,!t.from||t.from.includes(n.config.jid));return Object(I.jsx)(v.a,{className:"chat-message ".concat(c?"mine":""),sx:{background:c?Z.a[700]:"white",color:c?"white":"black",p:2,mx:2,my:1,borderRadius:3,marginLeft:c?"auto":0,marginRight:c?0:"auto"},children:t.body})};function ee(e,t){return te.apply(this,arguments)}function te(){return(te=Object(b.a)(d.a.mark((function e(t,n){var c,r,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c="".concat(t,"/api/meeting"),r=parseInt((new Date).getTime()/1e3),(a=new FormData).append("name","Instant Meeting"),a.append("mstart",r.toString()),a.append("duration","3600"),e.abrupt("return",fetch(c,{method:"POST",headers:{Authorization:n},body:a}).then((function(e){return e.json()})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ne=function(e){var t=e.open,n=e.close,r=e.allUsers,a=e.client,s=e.room,o=Object(c.useState)(""),i=Object(l.a)(o,2),j=i[0],d=i[1];return Object(I.jsxs)(g.a,{open:t,onClose:n,children:[Object(I.jsx)(w.a,{children:"Add User to Room"}),Object(I.jsx)(k.a,{children:Object(I.jsx)(P.a,{sx:{width:400,my:1},onChange:function(e,t){return t&&d(t.id)},options:r.map((function(e){return{label:"".concat(e.name," (").concat(e.user_email,")"),id:e.user_id}})),renderInput:function(e){return Object(I.jsx)(A.a,Object(u.a)(Object(u.a)({},e),{},{label:"User"}))}})}),Object(I.jsxs)(y.a,{children:[Object(I.jsx)(S.a,{onClick:n,children:"Cancel"}),Object(I.jsx)(S.a,{onClick:function(){var e="".concat(j,"@saas-msg.visionable.one");a.setRoomAffiliation(s.jid,e,"member"),n()},children:"Add"})]})]})},ce=function(e){var t=e.client,n=e.user,r=e.messages,a=e.API_BASE,s=e.jwt,o=e.allUsers,i=Object(c.useState)([]),j=Object(l.a)(i,2),O=j[0],f=j[1],p=Object(c.useState)(""),m=Object(l.a)(p,2),h=m[0],x=m[1],v=Object(c.useState)(!1),g=Object(l.a)(v,2),w=g[0],k=g[1],y=Object(c.useRef)(null),R=Object(c.useState)(null),P=Object(l.a)(R,2),_=P[0],E=P[1],z=Boolean(_),N=r.filter((function(e){var t,c;return(null===(t=e.from)||void 0===t?void 0:t.includes(n.jid))||(null===(c=e.to)||void 0===c?void 0:c.includes(n.jid))})),D=function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.isRoom){e.next=7;break}return e.next=3,t.setRoomAffiliation(n.jid,t.jid,"none");case 3:return e.next=5,t.leaveRoom(n.jid);case 5:e.next=11;break;case 7:return e.next=9,t.removeRosterItem(n.jid);case 9:return e.next=11,t.unsubscribe(n.jid);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),G=function(){if(h){var e=n.isRoom?"groupchat":"chat";t.sendMessage({to:n.jid,body:h,type:e}),x("")}},L=function(){var e=Object(b.a)(d.a.mark((function e(){var c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee(a,s);case 2:c=e.sent,console.log("body",c),c.uuid&&t.sendMessage({to:n.jid,body:c.uuid,type:"meeting-invite"});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=Object(b.a)(d.a.mark((function e(c){var r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getRoomMembers(n.jid);case 2:r=e.sent,f(r.muc.users.map((function(e){var t;return Object(u.a)(Object(u.a)({},e),{},{name:null===(t=o.find((function(t){return e.jid.includes(t.user_id)})))||void 0===t?void 0:t.name})}))),E(c.target);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),H=function(){return E(null)};return Object(c.useEffect)((function(){var e;y.current.scrollTop=null===y||void 0===y||null===(e=y.current)||void 0===e?void 0:e.scrollHeight}),[N]),Object(I.jsxs)(C.a,{sx:{flexGrow:1},children:[Object(I.jsx)(ne,{client:t,room:n,open:w,close:function(){return k(!1)},allUsers:o}),Object(I.jsxs)(C.a,{direction:"row",sx:{px:2,background:"white",alignItems:"center"},children:[Object(I.jsx)("h2",{children:n.name}),Object(I.jsx)(M.a,{onClick:D,children:Object(I.jsx)(Q.a,{fontSize:"inherit"})}),n.isRoom&&Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)(M.a,{onClick:B,children:Object(I.jsx)(Y.a,{fontSize:"inherit"})}),Object(I.jsxs)(U.a,{id:"basic-menu",anchorEl:_,open:z,onClose:H,MenuListProps:{"aria-labelledby":"basic-button"},children:[O.map((function(e){return Object(I.jsx)(T.a,{children:e.name},e.jid)})),Object(I.jsx)(K.a,{}),Object(I.jsx)(T.a,{onClick:function(){H(),k(!0)},children:"Add"})]})]}),Object(I.jsx)(M.a,{sx:{ml:"auto"},onClick:L,children:Object(I.jsx)(X.a,{fontSize:"inherit"})})]}),Object(I.jsx)(C.a,{sx:{background:"#eee",flexGrow:1,overflow:"auto",px:"10%"},ref:y,children:N.map((function(e){return Object(I.jsx)($,{message:e,client:t,isRoom:n.isRoom},e.id)}))}),Object(I.jsx)(C.a,{direction:"row",sx:{p:1},children:Object(I.jsx)(A.a,{onChange:function(e){return x(e.target.value)},value:h,sx:{flexGrow:1},placeholder:"Send a message...",onKeyPress:function(e){return"Enter"===e.key&&G()},InputProps:{endAdornment:Object(I.jsx)(S.a,{onClick:G,children:"Send"})}})})]})},re=function(e){var t=e.open,n=e.close,r=e.add,a=Object(c.useState)(""),s=Object(l.a)(a,2),o=s[0],i=s[1];return Object(I.jsxs)(g.a,{open:t,onClose:n,children:[Object(I.jsx)(w.a,{children:"Add Room"}),Object(I.jsx)(k.a,{children:Object(I.jsx)(A.a,{sx:{width:400,my:1},onChange:function(e){return i(e.target.value)},label:"Room name"})}),Object(I.jsxs)(y.a,{children:[Object(I.jsx)(S.a,{onClick:n,children:"Cancel"}),Object(I.jsx)(S.a,{onClick:function(){r(o),n()},children:"Add"})]})]})},ae=function(e){var t=e.open,n=e.close,r=e.add,a=e.allUsers,s=Object(c.useState)(""),o=Object(l.a)(s,2),i=o[0],j=o[1];return Object(I.jsxs)(g.a,{open:t,onClose:n,children:[Object(I.jsx)(w.a,{children:"Add Contact"}),Object(I.jsx)(k.a,{children:Object(I.jsx)(P.a,{sx:{width:400,my:1},onChange:function(e,t){return t&&j(t.id)},options:a.map((function(e){return{label:se(e),id:e.user_id}})),renderInput:function(e){return Object(I.jsx)(A.a,Object(u.a)(Object(u.a)({},e),{},{label:"User"}))}})}),Object(I.jsxs)(y.a,{children:[Object(I.jsx)(S.a,{onClick:n,children:"Cancel"}),Object(I.jsx)(S.a,{onClick:function(){r(i),n()},children:"Add"})]})]})},se=function(e){return"".concat(e.user_firstname," ").concat(e.user_lastname," (").concat(e.user_email,")")};function oe(e){var t,n,c;return null===(t=e.name)||void 0===t||null===(n=t.split(" "))||void 0===n||null===(c=n.slice(0,2))||void 0===c?void 0:c.map((function(e){return e.substr(0,1)}))}var ie=function(e){var t=e.roster,n=e.messages,r=(e.roomMessages,e.client),a=e.allUsers,s=e.API_BASE,o=e.MUC_LIGHT_HOSTNAME,i=e.jwt,u=(e.me,Object(c.useState)("")),j=Object(l.a)(u,2),O=j[0],f=j[1],p=Object(c.useState)(null),m=Object(l.a)(p,2),h=m[0],x=m[1],g=Object(c.useState)(!1),w=Object(l.a)(g,2),k=w[0],y=w[1],S=Object(c.useState)(!1),R=Object(l.a)(S,2),P=R[0],B=R[1],F=Object(c.useState)(null),K=Object(l.a)(F,2),J=K[0],Y=K[1],q=Boolean(J),Q=function(){Y(null)},V=function(){var e=Object(b.a)(d.a.mark((function e(t){var n,c,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=crypto.randomUUID(),c="".concat(n,"@").concat(o),e.next=4,r.joinRoom(c);case 4:a=e.sent,console.log("created room!",a),r.configureRoom(c,{fields:[{name:"roomname",value:t}]});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),X=t.filter((function(e){var t,n;return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(O.toLowerCase()))||(null===(n=e.jid)||void 0===n?void 0:n.includes(O))})),Z=h&&n[h.jid]?n[h.jid]:[];return Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)(ae,{add:function(e){var t="".concat(e,"@").concat(r.config.server);r.subscribe(t)},close:function(){return y(!1)},open:k,allUsers:a}),Object(I.jsx)(re,{add:V,close:function(){return B(!1)},open:P}),Object(I.jsxs)(_.a,{className:"scroll-list-container",sx:{width:300},children:[Object(I.jsxs)(v.a,{sx:{px:2},children:[Object(I.jsxs)(C.a,{direction:"row",sx:{alignItems:"center"},children:[Object(I.jsx)("h2",{children:"Contacts"}),Object(I.jsx)(M.a,{sx:{ml:"auto"},onClick:function(e){Y(e.currentTarget)},children:Object(I.jsx)(H.a,{fontSize:"inherit"})}),Object(I.jsxs)(U.a,{id:"basic-menu",anchorEl:J,open:q,onClose:Q,MenuListProps:{"aria-labelledby":"basic-button"},children:[Object(I.jsx)(T.a,{onClick:function(){Q(),y(!0)},children:"Add Contact"}),Object(I.jsx)(T.a,{onClick:function(){Q(),B(!0)},children:"Add Room"})]})]}),Object(I.jsx)(A.a,{type:"search",label:"Search",variant:"filled",size:"small",fullWidth:!0,onChange:function(e){return f(e.target.value)}})]}),Object(I.jsx)(E.a,{className:"scroll-list",children:X.map((function(e){var t;return Object(I.jsx)(z.a,{disablePadding:!0,children:Object(I.jsxs)(N.a,{onClick:function(){return x(e)},children:[Object(I.jsx)(D.a,{children:Object(I.jsx)(G.a,{children:e.isRoom?Object(I.jsx)(W.a,{}):oe(e)})}),Object(I.jsx)(L.a,{primary:e.name,primaryTypographyProps:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},secondary:null===(t=e.user)||void 0===t?void 0:t.user_email,secondaryTypographyProps:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},title:e.jid})]})},e.jid)}))})]}),Object(I.jsx)(_.a,{className:"right-section",children:h&&Object(I.jsx)(ce,{allUsers:a,client:r,user:h,messages:Z,API_BASE:s,jwt:i})})]})},ue=n(422),le=n(423),je=n(424),de=n(425),be=n(204),Oe=n.n(be),fe=n(205),pe=n.n(fe),me=n(206),he=n.n(me),xe=function(e){e.client,e.me;var t=Object(c.useState)(null),n=Object(l.a)(t,2),r=n[0],a=n[1],s=Boolean(r),o=function(){a(null)};return Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)(z.a,{disablePadding:!0,children:Object(I.jsx)(M.a,{onClick:function(e){a(e.currentTarget)},sx:{ml:.5},children:Object(I.jsx)(G.a,{sx:{width:32,height:32},children:"M"})})}),Object(I.jsxs)(U.a,{anchorEl:r,id:"account-menu",open:s,onClose:o,onClick:o,PaperProps:{elevation:0,sx:{overflow:"visible",filter:"drop-shadow(0px 2px 8px rgba(0,0,0,0.32))",mt:1.5,"& .MuiAvatar-root":{width:32,height:32,ml:-.5,mr:1},"&:before":{content:'""',display:"block",position:"absolute",top:0,right:14,width:10,height:10,bgcolor:"background.paper",transform:"translateY(-50%) rotate(45deg)",zIndex:0}}},transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:[Object(I.jsxs)(T.a,{children:[Object(I.jsx)(G.a,{})," Profile"]}),Object(I.jsxs)(T.a,{children:[Object(I.jsx)(G.a,{})," My account"]}),Object(I.jsx)(K.a,{}),Object(I.jsxs)(T.a,{children:[Object(I.jsx)(ue.a,{children:Object(I.jsx)(Oe.a,{fontSize:"small"})}),"Add another account"]}),Object(I.jsxs)(T.a,{children:[Object(I.jsx)(ue.a,{children:Object(I.jsx)(pe.a,{fontSize:"small"})}),"Settings"]}),Object(I.jsxs)(T.a,{children:[Object(I.jsx)(ue.a,{children:Object(I.jsx)(he.a,{fontSize:"small"})}),"Logout"]})]})]})},ve=[{route:"contacts",label:"Contacts",iconComponent:le.a},{route:"messages",label:"Messages",iconComponent:je.a}],ge=function(e){var t=e.client,n=e.me,c=e.setNav,r=e.nav,a=e.signOut;return Object(I.jsxs)(E.a,{sx:{display:"flex",flexDirection:"column",width:"200px",minWidth:"200px",background:"#091c38",color:"white"},children:[Object(I.jsx)(xe,{client:t,me:n}),ve.map((function(e){var t=e.iconComponent;return Object(I.jsx)(z.a,{disablePadding:!0,sx:{background:r===e.route?"rgba(255,255,255,0.1)":"transparent"},children:Object(I.jsxs)(N.a,{onClick:function(){return c(e.route)},children:[Object(I.jsx)(ue.a,{children:Object(I.jsx)(t,{sx:{color:"white"}})}),Object(I.jsx)(L.a,{children:e.label})]})},e.route)})),Object(I.jsx)(z.a,{disablePadding:!0,sx:{mt:"auto"},children:Object(I.jsxs)(N.a,{onClick:a,children:[Object(I.jsx)(ue.a,{children:Object(I.jsx)(de.a,{sx:{color:"white"}})}),Object(I.jsx)(L.a,{children:"Log Out"})]})})]})},we="https://saas-api.visionable.one",ke="saas-msg.visionable.one",ye="muclight.".concat(ke);f.default.configure({Auth:{region:"us-east-1",userPoolId:"us-east-1_ESYPvGhN3",userPoolWebClientId:"5ai2feek1rgpso497om1kbj4ug"}});var Se=localStorage.getItem("xmpp-resource")||crypto.randomUUID();localStorage.setItem("xmpp-resource",Se);var Ce=function(){var e=Object(b.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",O.a({jid:t,password:n,resource:Se,transports:{websocket:"".concat("wss","://").concat(ke,":").concat("5443","/").concat("ws-xmpp")}}));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Ae=function(e){var t=e.accept,n=e.reject,c=e.invites,r=e.responses;return c.filter((function(e){return!r[e.id]})).map((function(e){return Object(I.jsxs)(g.a,{open:!0,children:[Object(I.jsx)(w.a,{children:"Meeting Invite"}),Object(I.jsxs)(k.a,{children:[Object(I.jsxs)("p",{children:["Invite ID: ",e.id]}),Object(I.jsxs)("p",{children:["From: ",e.from]}),Object(I.jsxs)("p",{children:["Meeting ID: ",e.body]})]}),Object(I.jsxs)(y.a,{children:[Object(I.jsx)(S.a,{color:"error",onClick:function(){return n(e)},children:"Reject"}),Object(I.jsx)(S.a,{onClick:function(){return t(e)},children:"Accept"})]})]},e.id)}))},Ie=function(){var e=Object(b.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(we,"/api/user"),{headers:{Authorization:t}});case 2:return n=e.sent,e.abrupt("return",n.ok?n.json():[]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function Re(e){return(null===e||void 0===e?void 0:e.name)?e.name:(null===e||void 0===e?void 0:e.user_displayname)?e.user_displayname:(null===e||void 0===e?void 0:e.user_firstname)?"".concat(e.user_firstname," ").concat(e.user_lastname):"[No Name]"}var Pe=function(){var e=Object(c.useState)(null),t=Object(l.a)(e,2),n=t[0],r=t[1],a=Object(c.useState)(localStorage.getItem("username")||""),s=Object(l.a)(a,2),j=s[0],O=s[1],f=Object(c.useState)("Green12345!"),g=Object(l.a)(f,2),w=g[0],k=g[1],y=Object(c.useState)(""),S=Object(l.a)(y,2),C=(S[0],S[1]),A=Object(c.useState)(""),P=Object(l.a)(A,2),_=P[0],M=P[1],U=Object(c.useState)(!1),T=Object(l.a)(U,2),E=T[0],z=T[1],N=Object(c.useState)([]),D=Object(l.a)(N,2),G=D[0],L=D[1],B=Object(c.useState)({}),H=Object(l.a)(B,2),F=H[0],W=H[1],K=Object(c.useState)([]),J=Object(l.a)(K,2),Y=J[0],q=J[1],Q=Object(c.useState)({}),V=Object(l.a)(Q,2),X=V[0],Z=V[1],$=Object(c.useState)(!1),ee=Object(l.a)($,2),te=ee[0],ne=ee[1],ce=Object(c.useState)(null),re=Object(l.a)(ce,2),ae=re[0],se=re[1],oe=Object(c.useState)([]),ue=Object(l.a)(oe,2),le=ue[0],je=ue[1],de=Object(c.useState)("contacts"),be=Object(l.a)(de,2),Oe=be[0],fe=be[1],pe=Object(c.useState)({}),me=Object(l.a)(pe,2),he=me[0],xe=me[1],ve=Object(c.useState)({}),Se=Object(l.a)(ve,2),Pe=Se[0],_e=Se[1],Me=Object(c.useState)(!1),Ue=Object(l.a)(Me,2),Te=Ue[0],Ee=Ue[1],ze=function(){var e=Object(b.a)(d.a.mark((function e(){var t,c,a,s,O,f,m,h;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return se(""),ne(!0),localStorage.setItem("username",j),e.prev=3,e.next=6,p.a.signIn(j,w);case 6:return t=e.sent,c=t.username,a=t.signInUserSession,window.Auth=p.a,console.log(a),s=a.idToken.jwtToken,M(s),O="".concat(c,"@").concat(ke),C(O),e.next=17,Ce(O,s);case 17:return f=e.sent,console.log(O,s),r(f),ne(!1),Ee(!0),e.next=24,Ie(s);case 24:m=e.sent,h=m.map((function(e){return Object(u.a)(Object(u.a)({},e),{},{name:Re(e)})})),je(h),window.client=f,f.on("session:started",Object(b.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.sendPresence(),f.enableKeepAlive(),f.enableCarbons(),z(!0),e.next=6,f.getRoster();case 6:t=e.sent.items,L(t),xe({}),_e({}),t.forEach((function(e){f.searchHistory({with:e.jid,paging:{before:""}})}));case 11:case"end":return e.stop()}}),e)})))),f.on("message",(function(e){if("meeting-invite"===e.type)q((function(t){return[].concat(Object(i.a)(t),[e])}));else if("chat"===e.type){var t=e.from.split("/"),n=Object(l.a)(t,1)[0];xe((function(t){return Object(u.a)(Object(u.a)({},t),{},Object(o.a)({},n,[].concat(Object(i.a)(t[n]||[]),[e])))}))}else if("groupchat"===e.type){var c=e.from.split("/"),r=Object(l.a)(c,2),a=r[0],s=r[1];console.log("GOT A GROUPCHAT",a,s),xe((function(t){return Object(u.a)(Object(u.a)({},t),{},Object(o.a)({},a,[].concat(Object(i.a)(t[a]||[]),[e])))}))}})),f.on("message:sent",(function(e){if("meeting-invite"===e.type);else if("chat"===e.type){var t=e.to.split("/"),n=Object(l.a)(t,1)[0];xe((function(t){return Object(u.a)(Object(u.a)({},t),{},Object(o.a)({},n,[].concat(Object(i.a)(t[n]||[]),[e])))}))}else e.type})),f.on("mam:item",(function(e){var t,n,c=null===(t=e.archive)||void 0===t||null===(n=t.item)||void 0===n?void 0:n.message,r=c.to,a=c.from,s=(r.includes(f.config.jid)?a:r).split("/"),j=Object(l.a)(s,1)[0];xe((function(e){return Object(u.a)(Object(u.a)({},e),{},Object(o.a)({},j,[].concat(Object(i.a)(e[j]||[]),[c])))}))})),f.on("subscribe",(function(e){console.log("on subscribe",e),f.subscribe(e.from)})),f.on("muc:invite",(function(e){n.joinRoom(e.room)})),f.on("roster:update",Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=L,e.next=3,f.getRoster();case 3:return e.t1=e.sent.items,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))),f.on("muc:available",Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=L,e.next=3,f.getRoster();case 3:return e.t1=e.sent.items,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))),f.on("muc:unavailable",Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=L,e.next=3,f.getRoster();case 3:return e.t1=e.sent.items,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))),f.on("presence",(function(e){W((function(t){return Object(u.a)(Object(u.a)({},t),{},Object(o.a)({},e.from,e))}))})),f.on("*",function(){var e=Object(b.a)(d.a.mark((function e(t,n){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(t,n);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),f.on("disconnected",(function(){Ee(!1)})),f.on("connected",(function(){Ee(!0)})),f.connect(),e.next=49;break;case 44:e.prev=44,e.t0=e.catch(3),console.error("caught",e.t0),ne(!1),se(e.t0.message);case 49:case"end":return e.stop()}}),e,null,[[3,44]])})));return function(){return e.apply(this,arguments)}}();Object(c.useEffect)((function(){m.a.listen("auth",function(){var e=Object(b.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("tokenRefresh"!==t.payload.event){e.next=6;break}return console.log("token refreshed",t),e.next=4,p.a.currentSession();case 4:n.config.credentials.password=e.sent.idToken.jwtToken,n.connect();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]);var Ne=G.map((function(e){var t,n,c=le.find((function(t){return e.jid.includes(t.user_id)})),r=e.name?e.name:c?Re(c):e.jid,a=Object.values(F).filter((function(t){return t.from.includes(e.jid)})).map((function(e){var t;return null===(t=e.from.split("/"))||void 0===t?void 0:t[1]}));return Object(u.a)(Object(u.a)({},e),{},{user:c,name:r,resources:a,isRoom:!!(null===(t=e.groups)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.includes("muc"))})}));console.log("extended roster",Ne);var De=le.find((function(e){return n.jid.match(e.user_id)})),Ge=function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.currentSession();case 2:n.config.credentials.password=e.sent.idToken.jwtToken,n.connect();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Le=function(){var e=Object(b.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.disconnect(),z(!1),Ee(!1),L([]),W({}),xe({}),_e({}),e.prev=7,e.next=10,p.a.signOut();case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(7),console.log("error signing out: ",e.t0);case 15:case"end":return e.stop()}}),e,null,[[7,12]])})));return function(){return e.apply(this,arguments)}}();return E?Object(I.jsxs)("div",{className:"App",children:[Object(I.jsx)(ge,{nav:Oe,setNav:fe,signOut:Le,client:n,me:De}),Object(I.jsx)(h.a,{onClick:Ge,open:!Te,anchorOrigin:{horizontal:"center",vertical:"bottom"},sx:{cursor:"pointer"},children:Object(I.jsx)(x.a,{severity:"error",sx:{width:"100%"},children:"Disconnected. Click here to reconnect"})}),Object(I.jsx)(Ae,{accept:function(e){Z((function(t){return Object(u.a)(Object(u.a)({},t),{},Object(o.a)({},e.id,"accept"))})),n.sendMessage({to:e.from,body:e.id,type:"meeting-invite-accept"})},reject:function(e){Z((function(t){return Object(u.a)(Object(u.a)({},t),{},Object(o.a)({},e.id,"reject"))})),n.sendMessage({to:e.from,body:e.id,type:"meeting-invite-reject"})},invites:Y,responses:X}),Object(I.jsx)(v.a,{className:"main",children:"contacts"===Oe?Object(I.jsx)(ie,{roster:Ne,allUsers:le,messages:he,roomMessages:Pe,client:n,API_BASE:we,MUC_LIGHT_HOSTNAME:ye,jwt:_,me:De}):"messages"===Oe?Object(I.jsx)("div",{children:"Messages"}):null})]}):Object(I.jsx)("div",{className:"App",children:Object(I.jsx)(R,{loading:te,username:j,onChangeUsername:function(e){O(e.target.value),se(null)},password:w,onChangePassword:function(e){k(e.target.value),se(null)},error:ae,signIn:ze})})},_e=n(427);s.a.render(Object(I.jsxs)(r.a.StrictMode,{children:[Object(I.jsx)(_e.a,{}),Object(I.jsx)(Pe,{})]}),document.getElementById("root"))}},[[333,1,2]]]);
//# sourceMappingURL=main.670204da.chunk.js.map