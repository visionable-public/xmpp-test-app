(this["webpackJsonpxmpp-test"]=this["webpackJsonpxmpp-test"]||[]).push([[0],{262:function(e,t,n){},273:function(e,t){},328:function(e,t){},330:function(e,t){},336:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),c=n(75),s=n.n(c),i=n(6),o=n(18),u=n(33),l=n(198),d=n(8),j=n(4),b=n.n(j),p=n(31),f=n(217),m=n(209),O=n(218),h=n(281),x=n(434),v=n(432),g=n(443),w=n(444),y=n(426),S=n(445),k=n(446),C=n(436),A=new(n(163).default)("visionable-xmpp-test-app");A.version(1).stores({messages:"++id, group, from, to, body, type, timestamp"});var I=A,_=(n(262),n(411)),P=n(430),R=n(1),U=function(e){var t=e.loading,n=e.username,r=e.onChangeUsername,a=e.password,c=e.onChangePassword,s=e.server,i=e.onChangeServer,o=e.error,u=e.signIn;return Object(R.jsxs)(_.a,{spacing:3,sx:{width:"400px",maxWidth:"100%",my:3,mx:"auto"},children:[Object(R.jsx)(P.a,{label:"Server",disabled:!0,onChange:i,value:s,error:!!o}),Object(R.jsx)(P.a,{label:"Username",disabled:t,onChange:r,value:n,error:!!o}),Object(R.jsx)(P.a,{label:"Password",disabled:t,onKeyDown:function(e){return"Enter"===e.key&&u()},type:"password",onChange:c,value:a,error:!!o,helperText:o&&"Invalid credentials"}),Object(R.jsx)(C.a,{variant:"contained",disabled:t,onClick:u,children:" Sign in "})]})},T=n(440),E=n(435),M=n(425),L=n(420),N=n(421),z=n(423),B=n(424),D=n(437),G=n(220),H=n(442),F=n(422),K=n(441),W=n(203),q=n.n(W),Q=n(204),J=n.n(Q),Y=n(116),V=n.n(Y),X=function(e){var t=e.client,n=e.me,a=e.signOut,c=Object(r.useState)(null),s=Object(d.a)(c,2),i=s[0],o=s[1],u=Boolean(i),l=function(){o(null)},j=[{key:"available",color:"#53b397",label:"Available",icon:V.a},{key:"in-meeting",color:"#ea3323",label:"In a meeting",icon:V.a},{key:"away",color:"#f0a73e",label:"Away",icon:V.a}];return Object(R.jsxs)(R.Fragment,{children:[Object(R.jsxs)(E.a,{disablePadding:!0,children:[Object(R.jsx)(L.a,{children:Object(R.jsx)(K.a,{onClick:function(e){o(e.currentTarget)},sx:{ml:.5},children:Object(R.jsx)(D.a,{sx:{width:32,height:32},children:"M"})})}),Object(R.jsx)(N.a,{primary:n.name,primaryTypographyProps:{color:"white",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},secondary:n.user_email,secondaryTypographyProps:{color:"white",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},title:t.config.jid})]}),Object(R.jsxs)(G.a,{anchorEl:i,id:"account-menu",open:u,onClose:l,onClick:l,PaperProps:{elevation:0,sx:{overflow:"visible",filter:"drop-shadow(0px 2px 8px rgba(0,0,0,0.32))",mt:1.5,"& .MuiAvatar-root":{width:32,height:32,ml:-.5,mr:1},"&:before":{content:'""',display:"block",position:"absolute",top:0,right:14,width:10,height:10,bgcolor:"background.paper",transform:"translateY(-50%) rotate(45deg)",zIndex:0}}},transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:[Object(R.jsxs)(H.a,{disabled:!0,children:[Object(R.jsx)(D.a,{})," Profile"]}),Object(R.jsx)(F.a,{}),j.map((function(e){return Object(R.jsxs)(H.a,{onClick:function(){return n=e.key,void t.sendPresence({status:n});var n},children:[Object(R.jsx)(L.a,{children:Object(R.jsx)(V.a,{fontSize:"small",sx:{color:e.color}})}),Object(R.jsx)(N.a,{primary:e.label})]},e.key)})),Object(R.jsx)(F.a,{}),Object(R.jsxs)(H.a,{disabled:!0,children:[Object(R.jsx)(L.a,{children:Object(R.jsx)(q.a,{fontSize:"small"})}),"Settings"]}),Object(R.jsxs)(H.a,{onClick:a,children:[Object(R.jsx)(L.a,{children:Object(R.jsx)(J.a,{fontSize:"small"})}),"Logout"]})]})]})},Z=[{route:"contacts",label:"Contacts",iconComponent:z.a},{route:"messages",label:"Messages",iconComponent:B.a}],$=function(e){var t=e.client,n=e.me,r=e.setNav,a=e.nav,c=e.signOut;return Object(R.jsxs)(T.a,{sx:{display:"flex",flexDirection:"column",width:"200px",minWidth:"200px",background:"#091c38",color:"white"},children:[Object(R.jsx)(X,{client:t,me:n,signOut:c}),Z.map((function(e){var t=e.iconComponent;return Object(R.jsx)(E.a,{disablePadding:!0,sx:{background:a===e.route?"rgba(255,255,255,0.1)":"transparent"},children:Object(R.jsxs)(M.a,{onClick:function(){return r(e.route)},children:[Object(R.jsx)(L.a,{children:Object(R.jsx)(t,{sx:{color:"white"}})}),Object(R.jsx)(N.a,{children:e.label})]})},e.route)}))]})},ee=n(429),te=n(439),ne=n(447),re=n(208),ae=n.n(re),ce=n(137),se=n.n(ce),ie=n(206),oe=n.n(ie),ue=n(205),le=n.n(ue),de=n(207),je=n.n(de),be=n(81),pe=n(111),fe=function(e){var t=e.message,n=e.client,r=(e.isRoom,!t.from||t.from.includes(n.config.jid));return Object(R.jsxs)(g.a,{className:"chat-message ".concat(r?"mine":""),sx:{background:r?be.a[700]:"white",color:r?"white":"black",p:1.5,mx:2,my:1,borderRadius:2,marginLeft:r?"auto":0,marginRight:r?0:"auto"},children:[Object(R.jsxs)("span",{style:{fontSize:"0.8em"},children:[Object(R.jsx)("b",{children:t.name}),Object(R.jsx)("span",{style:{marginLeft:"1em",color:r?"#eee":"#666"},children:t.timestamp.toLocaleString()})]}),Object(R.jsx)("br",{}),t.body]})};function me(e,t){return Oe.apply(this,arguments)}function Oe(){return(Oe=Object(p.a)(b.a.mark((function e(t,n){var r,a,c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(t,"/api/meeting"),a=parseInt((new Date).getTime()/1e3),(c=new FormData).append("name","Instant Meeting"),c.append("mstart",a.toString()),c.append("duration","3600"),e.abrupt("return",fetch(r,{method:"POST",headers:{Authorization:n},body:c}).then((function(e){return e.json()})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var he=function(e){var t=e.open,n=e.close,a=e.allUsers,c=e.client,s=e.room,i=Object(r.useState)(""),o=Object(d.a)(i,2),l=o[0],j=o[1];return Object(R.jsxs)(w.a,{open:t,onClose:n,children:[Object(R.jsx)(y.a,{children:"Add User to Room"}),Object(R.jsx)(S.a,{children:Object(R.jsx)(ee.a,{sx:{width:400,my:1},onChange:function(e,t){return t&&j(t.id)},options:a.map((function(e){return{label:"".concat(e.name," (").concat(e.user_email,")"),id:e.user_id}})),renderInput:function(e){return Object(R.jsx)(P.a,Object(u.a)(Object(u.a)({},e),{},{label:"User"}))}})}),Object(R.jsxs)(k.a,{children:[Object(R.jsx)(C.a,{onClick:n,children:"Cancel"}),Object(R.jsx)(C.a,{onClick:function(){var e="".concat(l,"@saas-msg.visionable.one");c.setRoomAffiliation(s.jid,e,"member"),n()},children:"Add"})]})]})},xe=function(e){var t=e.client,n=e.user,a=e.API_BASE,c=e.jwt,s=e.allUsers,i=Object(r.useState)([]),o=Object(d.a)(i,2),l=o[0],j=o[1],f=Object(r.useState)(""),m=Object(d.a)(f,2),O=m[0],h=m[1],x=Object(r.useState)(!1),v=Object(d.a)(x,2),g=v[0],w=v[1],y=Object(r.useRef)(null),S=Object(r.useState)(null),k=Object(d.a)(S,2),A=k[0],U=k[1],T=Boolean(A),E=Object(pe.useLiveQuery)((function(){return I.messages.where("from").equals(n.jid).or("to").equals(n.jid).sortBy("timestamp")}),[n])||[],M=E.map((function(e){var t=s.find((function(t){return e.from.includes(t.user_id)})),n=(null===t||void 0===t?void 0:t.name)||e.from;return Object(u.a)(Object(u.a)({},e),{},{user:t,name:n})})),L=function(){var e=Object(p.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.isRoom){e.next=7;break}return e.next=3,t.setRoomAffiliation(n.jid,t.jid,"none");case 3:return e.next=5,t.leaveRoom(n.jid);case 5:e.next=11;break;case 7:return e.next=9,t.removeRosterItem(n.jid);case 9:return e.next=11,t.unsubscribe(n.jid);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),N=function(){if(O){var e=n.isRoom?"groupchat":"chat";t.sendMessage({to:n.jid,body:O,type:e}),h("")}},z=function(){var e=Object(p.a)(b.a.mark((function e(){var r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,me(a,c);case 2:(r=e.sent).uuid&&t.sendMessage({to:n.jid,body:r.uuid,type:"meeting-invite"});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=Object(p.a)(b.a.mark((function e(r){var a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getRoomMembers(n.jid);case 2:a=e.sent,j(a.muc.users.map((function(e){var t;return Object(u.a)(Object(u.a)({},e),{},{name:null===(t=s.find((function(t){return e.jid.includes(t.user_id)})))||void 0===t?void 0:t.name})}))),U(r.target);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=function(){return U(null)};return Object(r.useEffect)((function(){var e;y.current.scrollTop=null===y||void 0===y||null===(e=y.current)||void 0===e?void 0:e.scrollHeight}),[E]),Object(R.jsxs)(_.a,{sx:{flexGrow:1},children:[Object(R.jsx)(he,{client:t,room:n,open:g,close:function(){return w(!1)},allUsers:s}),Object(R.jsxs)(_.a,{direction:"row",sx:{px:2,background:"white",alignItems:"center"},children:[Object(R.jsx)("h2",{children:n.name}),Object(R.jsx)(K.a,{sx:{ml:"auto"},onClick:L,children:Object(R.jsx)(le.a,{fontSize:"inherit"})}),n.isRoom&&Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)(K.a,{onClick:B,children:Object(R.jsx)(oe.a,{fontSize:"inherit"})}),Object(R.jsxs)(G.a,{id:"basic-menu",anchorEl:A,open:T,onClose:D,MenuListProps:{"aria-labelledby":"basic-button"},children:[l.map((function(e){return Object(R.jsx)(H.a,{children:e.name},e.jid)})),Object(R.jsx)(F.a,{}),Object(R.jsx)(H.a,{onClick:function(){D(),w(!0)},children:"Add"})]})]}),Object(R.jsx)(K.a,{onClick:z,children:Object(R.jsx)(je.a,{fontSize:"inherit"})})]}),Object(R.jsx)(_.a,{sx:{background:"#eee",flexGrow:1,overflow:"auto",px:"10%"},ref:y,children:M.map((function(e){return Object(R.jsx)(fe,{message:e,client:t,isRoom:n.isRoom},e.id)}))}),Object(R.jsx)(_.a,{direction:"row",sx:{p:1},children:Object(R.jsx)(P.a,{onChange:function(e){return h(e.target.value)},value:O,sx:{flexGrow:1},placeholder:"Send a message...",onKeyPress:function(e){return"Enter"===e.key&&N()},InputProps:{endAdornment:Object(R.jsx)(C.a,{onClick:N,children:"Send"})}})})]})},ve=function(e){var t=e.open,n=e.close,a=e.add,c=Object(r.useState)(""),s=Object(d.a)(c,2),i=s[0],o=s[1];return Object(R.jsxs)(w.a,{open:t,onClose:n,children:[Object(R.jsx)(y.a,{children:"Add Room"}),Object(R.jsx)(S.a,{children:Object(R.jsx)(P.a,{sx:{width:400,my:1},onChange:function(e){return o(e.target.value)},label:"Room name"})}),Object(R.jsxs)(k.a,{children:[Object(R.jsx)(C.a,{onClick:n,children:"Cancel"}),Object(R.jsx)(C.a,{onClick:function(){a(i),n()},children:"Add"})]})]})},ge=function(e){var t=e.open,n=e.close,a=e.add,c=e.allUsers,s=Object(r.useState)(""),i=Object(d.a)(s,2),o=i[0],l=i[1];return Object(R.jsxs)(w.a,{open:t,onClose:n,children:[Object(R.jsx)(y.a,{children:"Add Contact"}),Object(R.jsx)(S.a,{children:Object(R.jsx)(ee.a,{sx:{width:400,my:1},onChange:function(e,t){return t&&l(t.id)},options:c.map((function(e){return{label:we(e),id:e.user_id}})),renderInput:function(e){return Object(R.jsx)(P.a,Object(u.a)(Object(u.a)({},e),{},{label:"User"}))}})}),Object(R.jsxs)(k.a,{children:[Object(R.jsx)(C.a,{onClick:n,children:"Cancel"}),Object(R.jsx)(C.a,{onClick:function(){a(o),n()},children:"Add"})]})]})},we=function(e){return"".concat(e.user_firstname," ").concat(e.user_lastname," (").concat(e.user_email,")")};function ye(e){var t,n,r;return null===(t=e.name)||void 0===t||null===(n=t.split(" "))||void 0===n||null===(r=n.slice(0,2))||void 0===r?void 0:r.map((function(e){return e.substr(0,1)}))}var Se=function(e){var t=e.roster,n=e.client,a=e.allUsers,c=e.API_BASE,s=e.MUC_LIGHT_HOSTNAME,i=e.jwt,o=Object(r.useState)(""),u=Object(d.a)(o,2),l=u[0],j=u[1],f=Object(r.useState)(null),m=Object(d.a)(f,2),O=m[0],h=m[1],x=Object(r.useState)(!1),v=Object(d.a)(x,2),w=v[0],y=v[1],S=Object(r.useState)(!1),k=Object(d.a)(S,2),C=k[0],A=k[1],I=Object(r.useState)(null),U=Object(d.a)(I,2),L=U[0],z=U[1],B=Boolean(L),F=function(){z(null)},W=function(){var e=Object(p.a)(b.a.mark((function e(t){var r,a,c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=crypto.randomUUID(),a="".concat(r,"@").concat(s),e.next=4,n.joinRoom(a);case 4:c=e.sent,console.log("created room!",c),n.configureRoom(a,{fields:[{name:"roomname",value:t}]});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),q=t.filter((function(e){var t,n;return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(l.toLowerCase()))||(null===(n=e.jid)||void 0===n?void 0:n.includes(l))})),Q={},J=O&&Q[O.jid]?Q[O.jid]:[];return Object(R.jsxs)(R.Fragment,{children:[Object(R.jsx)(ge,{add:function(e){var t="".concat(e,"@").concat(n.config.server);n.subscribe(t)},close:function(){return y(!1)},open:w,allUsers:a}),Object(R.jsx)(ve,{add:W,close:function(){return A(!1)},open:C}),Object(R.jsxs)(te.a,{className:"scroll-list-container",sx:{width:300},children:[Object(R.jsxs)(g.a,{sx:{px:2},children:[Object(R.jsxs)(_.a,{direction:"row",sx:{alignItems:"center"},children:[Object(R.jsx)("h2",{children:"Contacts"}),Object(R.jsx)(K.a,{sx:{ml:"auto"},onClick:function(e){z(e.currentTarget)},children:Object(R.jsx)(ae.a,{fontSize:"inherit"})}),Object(R.jsxs)(G.a,{id:"basic-menu",anchorEl:L,open:B,onClose:F,MenuListProps:{"aria-labelledby":"basic-button"},children:[Object(R.jsx)(H.a,{onClick:function(){F(),y(!0)},children:"Add Contact"}),Object(R.jsx)(H.a,{onClick:function(){F(),A(!0)},children:"Add Room"})]})]}),Object(R.jsx)(P.a,{type:"search",label:"Search",variant:"filled",size:"small",fullWidth:!0,onChange:function(e){return j(e.target.value)}})]}),Object(R.jsx)(T.a,{className:"scroll-list",children:q.map((function(e){var t;return Object(R.jsx)(E.a,{disablePadding:!0,children:Object(R.jsxs)(M.a,{onClick:function(){return h(e)},children:[Object(R.jsx)(ne.a,{children:Object(R.jsx)(D.a,{children:e.isRoom?Object(R.jsx)(se.a,{}):ye(e)})}),Object(R.jsx)(N.a,{primary:e.name,primaryTypographyProps:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},secondary:null===(t=e.user)||void 0===t?void 0:t.user_email,secondaryTypographyProps:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},title:e.jid})]})},e.jid)}))})]}),Object(R.jsx)(te.a,{className:"right-section",children:O&&Object(R.jsx)(xe,{allUsers:a,client:n,user:O,messages:J,API_BASE:c,jwt:i})})]})};function ke(e){var t,n,r;return null===(t=e.name)||void 0===t||null===(n=t.split(" "))||void 0===n||null===(r=n.slice(0,2))||void 0===r?void 0:r.map((function(e){return e.substr(0,1)}))}var Ce=function(e){var t=e.client,n=e.allUsers,a=e.roster,c=e.jwt,s=e.API_BASE,i=Object(r.useState)(""),o=Object(d.a)(i,2),u=o[0],l=o[1],j=Object(r.useState)(null),b=Object(d.a)(j,2),p=b[0],f=b[1],m=Object(pe.useLiveQuery)((function(){return I.messages.orderBy("to").uniqueKeys()}))||[],O=Object(pe.useLiveQuery)((function(){return I.messages.orderBy("from").uniqueKeys()}))||[],h=m.concat(O).filter((function(e,t,n){return n.indexOf(e)===t})),x=null===h||void 0===h?void 0:h.map((function(e){var t,r=n.find((function(t){return e.includes(t.user_id)})),c=(null===r||void 0===r?void 0:r.name)||(null===(t=a.find((function(t){return t.jid===e})))||void 0===t?void 0:t.name)||e;return{jid:e,user:r,name:c}})),v=null===x||void 0===x?void 0:x.filter((function(e){var t,n,r,a,c,s=u.toLowerCase();return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(s))||s.includes(null===(n=e.name)||void 0===n?void 0:n.toLowerCase())||(null===(r=e.user)||void 0===r||null===(a=r.user_email)||void 0===a?void 0:a.includes(s))||s.includes(null===(c=e.user)||void 0===c?void 0:c.user_email)}));return Object(R.jsxs)(R.Fragment,{children:[Object(R.jsxs)(te.a,{className:"scroll-list-container",sx:{width:300},children:[Object(R.jsxs)(g.a,{sx:{px:2},children:[Object(R.jsx)(_.a,{direction:"row",sx:{alignItems:"center"},children:Object(R.jsx)("h2",{children:"Chat"})}),Object(R.jsx)(P.a,{type:"search",label:"Search",variant:"filled",size:"small",fullWidth:!0,onChange:function(e){return l(e.target.value)}})]}),Object(R.jsx)(T.a,{className:"scroll-list",children:v.map((function(e){var t;return Object(R.jsx)(E.a,{disablePadding:!0,children:Object(R.jsxs)(M.a,{onClick:function(){return f(e)},children:[Object(R.jsx)(ne.a,{children:Object(R.jsx)(D.a,{children:e.isRoom?Object(R.jsx)(se.a,{}):ke(e)})}),Object(R.jsx)(N.a,{primary:e.name,primaryTypographyProps:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},secondary:null===(t=e.user)||void 0===t?void 0:t.user_email,secondaryTypographyProps:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},title:e.jid})]})},e.jid)}))})]}),Object(R.jsx)(te.a,{className:"right-section",children:p&&Object(R.jsx)(xe,{allUsers:n,client:t,user:p,API_BASE:s,jwt:c})})]})};window.db=I;var Ae="https://saas-api.visionable.one";m.default.configure({Auth:{region:"us-east-1",userPoolId:"us-east-1_ESYPvGhN3",userPoolWebClientId:"5ai2feek1rgpso497om1kbj4ug"}});var Ie=localStorage.getItem("xmpp-resource")||crypto.randomUUID();localStorage.setItem("xmpp-resource",Ie);var _e=function(){var e=Object(p.a)(b.a.mark((function e(t,n,r){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",f.a({jid:t,password:n,resource:Ie,transports:{websocket:"".concat("wss","://").concat(r,":").concat("5443","/").concat("ws-xmpp")}}));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Pe=function(e){var t=e.accept,n=e.reject,r=e.invites,a=e.responses;return r.filter((function(e){return!a[e.id]})).map((function(e){return Object(R.jsxs)(w.a,{open:!0,children:[Object(R.jsx)(y.a,{children:"Meeting Invite"}),Object(R.jsxs)(S.a,{children:[Object(R.jsxs)("p",{children:["Invite ID: ",e.id]}),Object(R.jsxs)("p",{children:["From: ",e.from]}),Object(R.jsxs)("p",{children:["Meeting ID: ",e.body]})]}),Object(R.jsxs)(k.a,{children:[Object(R.jsx)(C.a,{color:"error",onClick:function(){return n(e)},children:"Reject"}),Object(R.jsx)(C.a,{onClick:function(){return t(e)},children:"Accept"})]})]},e.id)}))},Re=function(){var e=Object(p.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(Ae,"/api/user"),{headers:{Authorization:t}});case 2:return n=e.sent,e.abrupt("return",n.ok?n.json():[]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function Ue(e){return(null===e||void 0===e?void 0:e.name)?e.name:(null===e||void 0===e?void 0:e.user_displayname)?e.user_displayname:(null===e||void 0===e?void 0:e.user_firstname)?"".concat(e.user_firstname," ").concat(e.user_lastname):"[No Name]"}function Te(e){return Ee.apply(this,arguments)}function Ee(){return(Ee=Object(p.a)(b.a.mark((function e(t){var n,r,a,c,s,i,o;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.client,r=t.start,a=t.after,c=a?{after:a}:{},e.next=4,n.searchHistory({start:r,paging:c});case 4:s=e.sent,i=s.complete,o=s.paging.last,i||Te({client:n,after:o});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Me=function(){var e=Object(r.useState)(null),t=Object(d.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(localStorage.getItem("username")||""),s=Object(d.a)(c,2),j=s[0],f=s[1],m=Object(r.useState)("Green12345!"),w=Object(d.a)(m,2),y=w[0],S=w[1],k=Object(r.useState)(""),C=Object(d.a)(k,2),A=(C[0],C[1]),_=Object(r.useState)(""),P=Object(d.a)(_,2),T=P[0],E=P[1],M=Object(r.useState)(!1),L=Object(d.a)(M,2),N=L[0],z=L[1],B=Object(r.useState)([]),D=Object(d.a)(B,2),G=D[0],H=D[1],F=Object(r.useState)({}),K=Object(d.a)(F,2),W=K[0],q=K[1],Q=Object(r.useState)([]),J=Object(d.a)(Q,2),Y=J[0],V=J[1],X=Object(r.useState)({}),Z=Object(d.a)(X,2),ee=Z[0],te=Z[1],ne=Object(r.useState)(!1),re=Object(d.a)(ne,2),ae=re[0],ce=re[1],se=Object(r.useState)(null),ie=Object(d.a)(se,2),oe=ie[0],ue=ie[1],le=Object(r.useState)([]),de=Object(d.a)(le,2),je=de[0],be=de[1],pe=Object(r.useState)("contacts"),fe=Object(d.a)(pe,2),me=fe[0],Oe=fe[1],he=Object(r.useState)(!1),xe=Object(d.a)(he,2),ve=xe[0],ge=xe[1],we=Object(r.useState)("saas.visionable.one"),ye=Object(d.a)(we,2),ke=ye[0],Ie=ye[1],Ee=Object(r.useState)({}),Me=Object(d.a)(Ee,2);Me[0],Me[1];Object(r.useEffect)((function(){Object(p.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}),[ke]);var Le=ke.split(/\.([\s\S]*)/),Ne=Object(l.a)(Le),ze=Ne[0],Be=Object(d.a)(Ne.slice(1),1)[0],De="".concat(ze,"-msg.").concat(Be),Ge="muclight.".concat(De),He=function(){var e=Object(p.a)(b.a.mark((function e(){var t,r,c,s,l,f,m,h;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ue(""),ce(!0),localStorage.getItem("username")===j){e.next=5;break}return e.next=5,I.messages.clear();case 5:return localStorage.setItem("username",j),e.prev=6,e.next=9,O.a.signIn(j,y);case 9:return t=e.sent,r=t.username,c=t.signInUserSession,s=c.idToken.jwtToken,E(s),l="".concat(r,"@").concat(De),A(l),e.next=18,_e(l,s,De);case 18:return f=e.sent,a(f),ce(!1),ge(!0),e.next=24,Re(s);case 24:m=e.sent,h=m.map((function(e){return Object(u.a)(Object(u.a)({},e),{},{name:Ue(e)})})),be(h),window.client=f,f.on("session:started",Object(p.a)(b.a.mark((function e(){var t,n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.sendPresence(),f.enableKeepAlive(),f.enableCarbons(),z(!0),e.next=6,f.getRoster();case 6:return t=e.sent.items,H(t),e.next=10,I.messages.orderBy("timestamp").last();case 10:n=e.sent,Te({client:f,start:null===n||void 0===n?void 0:n.timestamp});case 12:case"end":return e.stop()}}),e)})))),f.on("message",(function(e){if("meeting-invite"===e.type)V((function(t){return[].concat(Object(o.a)(t),[e])}));else if("chat"===e.type){var t=e.from.split("/"),n=Object(d.a)(t,1)[0];I.messages.put({id:e.id,from:n,to:e.to,body:e.body,type:e.type,group:null,timestamp:new Date},e.id)}else if("groupchat"===e.type){var r=e.from.split("/"),a=Object(d.a)(r,2),c=a[0],s=a[1];console.log("GOT A GROUPCHAT",c,s)}})),f.on("message:sent",(function(e){"meeting-invite"===e.type||("chat"===e.type?I.messages.put({id:e.id,from:f.config.jid,to:e.to,body:e.body,type:e.type,group:null,timestamp:new Date},e.id):e.type)})),f.on("mam:item",(function(e){var t,n,r,a,c,s=null===(t=e.archive)||void 0===t||null===(n=t.item)||void 0===n?void 0:n.message,i=null===(r=e.archive)||void 0===r||null===(a=r.item)||void 0===a||null===(c=a.delay)||void 0===c?void 0:c.timestamp;if("chat"===s.type){var o=s.to,u=s.from.split("/"),l=Object(d.a)(u,1)[0];if(!((null===o||void 0===o?void 0:o.includes(f.config.jid))?l:o))return void console.log("NO FULL USER",s);I.messages.put({id:s.id,from:l,to:s.to,body:s.body,type:s.type,group:null,timestamp:i},s.id)}})),f.on("subscribe",(function(e){f.acceptSubscription(e.from)})),f.on("unsubscribe",(function(e){})),f.on("roster:update",function(){var e=Object(p.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.roster.items.forEach((function(e){f.searchHistory({with:e.jid,paging:{before:""}})})),e.t0=H,e.next=4,f.getRoster();case 4:e.t1=e.sent.items,(0,e.t0)(e.t1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),f.on("muc:invite",(function(e){n.joinRoom(e.room)})),f.on("muc:available",Object(p.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=H,e.next=3,f.getRoster();case 3:return e.t1=e.sent.items,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))),f.on("muc:unavailable",Object(p.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=H,e.next=3,f.getRoster();case 3:return e.t1=e.sent.items,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))),f.on("presence",(function(e){q((function(t){return Object(u.a)(Object(u.a)({},t),{},Object(i.a)({},e.from,e))}))})),f.on("*",function(){var e=Object(p.a)(b.a.mark((function e(t,n){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(t,n);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),f.on("disconnected",(function(){ge(!1)})),f.on("connected",(function(){ge(!0)})),f.connect(),e.next=50;break;case 45:e.prev=45,e.t0=e.catch(6),console.error("caught",e.t0),ce(!1),ue(e.t0.message);case 50:case"end":return e.stop()}}),e,null,[[6,45]])})));return function(){return e.apply(this,arguments)}}();Object(r.useEffect)((function(){h.a.listen("auth",function(){var e=Object(p.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"tokenRefresh"===t.payload.event&&console.log("token refreshed",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]);var Fe=G.map((function(e){var t,n,r=je.find((function(t){return e.jid.includes(t.user_id)})),a=e.name?e.name:r?Ue(r):e.jid,c=Object.values(W).filter((function(t){return t.from.includes(e.jid)})).map((function(e){var t;return null===(t=e.from.split("/"))||void 0===t?void 0:t[1]}));return Object(u.a)(Object(u.a)({},e),{},{user:r,name:a,resources:c,isRoom:!!(null===(t=e.groups)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.includes("muc"))})})),Ke=je.find((function(e){return n.jid.match(e.user_id)})),We=function(){var e=Object(p.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.a.currentSession();case 2:n.config.credentials.password=e.sent.idToken.jwtToken,n.connect();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),qe=function(){var e=Object(p.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.disconnect(),z(!1),ge(!1),H([]),q({}),I.messages.clear(),e.prev=6,e.next=9,O.a.signOut();case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),console.log("error signing out: ",e.t0);case 14:case"end":return e.stop()}}),e,null,[[6,11]])})));return function(){return e.apply(this,arguments)}}();return N?Object(R.jsxs)("div",{className:"App",children:[Object(R.jsx)($,{nav:me,setNav:Oe,signOut:qe,client:n,me:Ke}),Object(R.jsx)(x.a,{onClick:We,open:!ve,anchorOrigin:{horizontal:"center",vertical:"bottom"},sx:{cursor:"pointer"},children:Object(R.jsx)(v.a,{severity:"error",sx:{width:"100%"},children:"Disconnected. Click here to reconnect"})}),Object(R.jsx)(Pe,{accept:function(e){te((function(t){return Object(u.a)(Object(u.a)({},t),{},Object(i.a)({},e.id,"accept"))})),n.sendMessage({to:e.from,body:e.id,type:"meeting-invite-accept"})},reject:function(e){te((function(t){return Object(u.a)(Object(u.a)({},t),{},Object(i.a)({},e.id,"reject"))})),n.sendMessage({to:e.from,body:e.id,type:"meeting-invite-reject"})},invites:Y,responses:ee}),Object(R.jsx)(g.a,{className:"main",children:"contacts"===me?Object(R.jsx)(Se,{roster:Fe,allUsers:je,client:n,API_BASE:Ae,MUC_LIGHT_HOSTNAME:Ge,jwt:T}):"messages"===me?Object(R.jsx)(Ce,{roster:Fe,allUsers:je,client:n,API_BASE:Ae,MUC_LIGHT_HOSTNAME:Ge,jwt:T}):null})]}):Object(R.jsx)("div",{className:"App",children:Object(R.jsx)(U,{loading:ae,username:j,onChangeUsername:function(e){f(e.target.value),ue(null)},password:y,onChangePassword:function(e){S(e.target.value),ue(null)},error:oe,signIn:He,server:ke,onChangeServer:function(e){Ie(e.target.value),ue(null)}})})},Le=n(428);s.a.render(Object(R.jsxs)(a.a.StrictMode,{children:[Object(R.jsx)(Le.a,{}),Object(R.jsx)(Me,{})]}),document.getElementById("root"))}},[[336,1,2]]]);
//# sourceMappingURL=main.3aa08a06.chunk.js.map