(this["webpackJsonpxmpp-test"]=this["webpackJsonpxmpp-test"]||[]).push([[0],{260:function(e,t,n){},271:function(e,t){},326:function(e,t){},328:function(e,t){},334:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),a=n(75),s=n.n(a),o=n(6),i=n(18),l=n(25),u=n(197),j=n(8),d=n(4),b=n.n(d),O=n(32),p=n(216),f=n(208),h=n(217),m=n(279),x=n(433),v=n(431),g=n(442),w=n(443),y=n(425),S=n(444),k=n(445),C=n(435),A=(n(260),n(409)),I=n(429),P=n(1),_=function(e){var t=e.loading,n=e.username,r=e.onChangeUsername,c=e.password,a=e.onChangePassword,s=e.server,o=e.onChangeServer,i=e.error,l=e.signIn;return Object(P.jsxs)(A.a,{spacing:3,sx:{width:"400px",maxWidth:"100%",my:3,mx:"auto"},children:[Object(P.jsx)(I.a,{label:"Server",disabled:!0,onChange:o,value:s,error:!!i}),Object(P.jsx)(I.a,{label:"Username",disabled:t,onChange:r,value:n,error:!!i}),Object(P.jsx)(I.a,{label:"Password",disabled:t,onKeyDown:function(e){return"Enter"===e.key&&l()},type:"password",onChange:a,value:c,error:!!i,helperText:i&&"Invalid credentials"}),Object(P.jsx)(C.a,{variant:"contained",disabled:t,onClick:l,children:" Sign in "})]})},R=n(439),U=n(434),T=n(423),E=n(418),M=n(419),N=n(421),z=n(422),L=n(424),G=n(436),B=n(219),H=n(441),D=n(420),F=n(440),W=n(202),K=n.n(W),J=n(203),Y=n.n(J),q=n(115),Q=n.n(q),V=function(e){var t=e.client,n=e.me,c=Object(r.useState)(null),a=Object(j.a)(c,2),s=a[0],o=a[1],i=Boolean(s),l=function(){o(null)},u=[{key:"available",color:"#53b397",label:"Available",icon:Q.a},{key:"in-meeting",color:"#ea3323",label:"In a meeting",icon:Q.a},{key:"away",color:"#f0a73e",label:"Away",icon:Q.a}];return Object(P.jsxs)(P.Fragment,{children:[Object(P.jsxs)(U.a,{disablePadding:!0,children:[Object(P.jsx)(E.a,{children:Object(P.jsx)(F.a,{onClick:function(e){o(e.currentTarget)},sx:{ml:.5},children:Object(P.jsx)(G.a,{sx:{width:32,height:32},children:"M"})})}),Object(P.jsx)(M.a,{primary:n.name,primaryTypographyProps:{color:"white",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},secondary:n.user_email,secondaryTypographyProps:{color:"white",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},title:t.config.jid})]}),Object(P.jsxs)(B.a,{anchorEl:s,id:"account-menu",open:i,onClose:l,onClick:l,PaperProps:{elevation:0,sx:{overflow:"visible",filter:"drop-shadow(0px 2px 8px rgba(0,0,0,0.32))",mt:1.5,"& .MuiAvatar-root":{width:32,height:32,ml:-.5,mr:1},"&:before":{content:'""',display:"block",position:"absolute",top:0,right:14,width:10,height:10,bgcolor:"background.paper",transform:"translateY(-50%) rotate(45deg)",zIndex:0}}},transformOrigin:{horizontal:"right",vertical:"top"},anchorOrigin:{horizontal:"right",vertical:"bottom"},children:[Object(P.jsxs)(H.a,{children:[Object(P.jsx)(G.a,{})," Profile"]}),Object(P.jsx)(D.a,{}),u.map((function(e){return Object(P.jsxs)(H.a,{onClick:function(){return n=e.key,void t.sendPresence({status:n});var n},children:[Object(P.jsx)(E.a,{children:Object(P.jsx)(Q.a,{fontSize:"small",sx:{color:e.color}})}),Object(P.jsx)(M.a,{primary:e.label})]},e.key)})),Object(P.jsx)(D.a,{}),Object(P.jsxs)(H.a,{children:[Object(P.jsx)(E.a,{children:Object(P.jsx)(K.a,{fontSize:"small"})}),"Settings"]}),Object(P.jsxs)(H.a,{children:[Object(P.jsx)(E.a,{children:Object(P.jsx)(Y.a,{fontSize:"small"})}),"Logout"]})]})]})},X=[{route:"contacts",label:"Contacts",iconComponent:N.a},{route:"messages",label:"Messages",iconComponent:z.a}],Z=function(e){var t=e.client,n=e.me,r=e.setNav,c=e.nav,a=e.signOut;return Object(P.jsxs)(R.a,{sx:{display:"flex",flexDirection:"column",width:"200px",minWidth:"200px",background:"#091c38",color:"white"},children:[Object(P.jsx)(V,{client:t,me:n}),X.map((function(e){var t=e.iconComponent;return Object(P.jsx)(U.a,{disablePadding:!0,sx:{background:c===e.route?"rgba(255,255,255,0.1)":"transparent"},children:Object(P.jsxs)(T.a,{onClick:function(){return r(e.route)},children:[Object(P.jsx)(E.a,{children:Object(P.jsx)(t,{sx:{color:"white"}})}),Object(P.jsx)(M.a,{children:e.label})]})},e.route)})),Object(P.jsx)(U.a,{disablePadding:!0,sx:{mt:"auto"},children:Object(P.jsxs)(T.a,{onClick:a,children:[Object(P.jsx)(E.a,{children:Object(P.jsx)(L.a,{sx:{color:"white"}})}),Object(P.jsx)(M.a,{children:"Log Out"})]})})]})},$=n(428),ee=n(438),te=n(446),ne=n(207),re=n.n(ne),ce=n(136),ae=n.n(ce),se=n(205),oe=n.n(se),ie=n(204),le=n.n(ie),ue=n(206),je=n.n(ue),de=n(81),be=function(e){var t=e.message,n=e.client,r=(e.isRoom,!t.from||t.from.includes(n.config.jid));return Object(P.jsx)(g.a,{className:"chat-message ".concat(r?"mine":""),sx:{background:r?de.a[700]:"white",color:r?"white":"black",p:2,mx:2,my:1,borderRadius:3,marginLeft:r?"auto":0,marginRight:r?0:"auto"},children:t.body})};function Oe(e,t){return pe.apply(this,arguments)}function pe(){return(pe=Object(O.a)(b.a.mark((function e(t,n){var r,c,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(t,"/api/meeting"),c=parseInt((new Date).getTime()/1e3),(a=new FormData).append("name","Instant Meeting"),a.append("mstart",c.toString()),a.append("duration","3600"),e.abrupt("return",fetch(r,{method:"POST",headers:{Authorization:n},body:a}).then((function(e){return e.json()})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var fe=function(e){var t=e.open,n=e.close,c=e.allUsers,a=e.client,s=e.room,o=Object(r.useState)(""),i=Object(j.a)(o,2),u=i[0],d=i[1];return Object(P.jsxs)(w.a,{open:t,onClose:n,children:[Object(P.jsx)(y.a,{children:"Add User to Room"}),Object(P.jsx)(S.a,{children:Object(P.jsx)($.a,{sx:{width:400,my:1},onChange:function(e,t){return t&&d(t.id)},options:c.map((function(e){return{label:"".concat(e.name," (").concat(e.user_email,")"),id:e.user_id}})),renderInput:function(e){return Object(P.jsx)(I.a,Object(l.a)(Object(l.a)({},e),{},{label:"User"}))}})}),Object(P.jsxs)(k.a,{children:[Object(P.jsx)(C.a,{onClick:n,children:"Cancel"}),Object(P.jsx)(C.a,{onClick:function(){var e="".concat(u,"@saas-msg.visionable.one");a.setRoomAffiliation(s.jid,e,"member"),n()},children:"Add"})]})]})},he=function(e){var t=e.client,n=e.user,c=e.messages,a=e.API_BASE,s=e.jwt,o=e.allUsers,i=Object(r.useState)([]),u=Object(j.a)(i,2),d=u[0],p=u[1],f=Object(r.useState)(""),h=Object(j.a)(f,2),m=h[0],x=h[1],v=Object(r.useState)(!1),g=Object(j.a)(v,2),w=g[0],y=g[1],S=Object(r.useRef)(null),k=Object(r.useState)(null),_=Object(j.a)(k,2),R=_[0],U=_[1],T=Boolean(R),E=c.filter((function(e){var t,r;return(null===(t=e.from)||void 0===t?void 0:t.includes(n.jid))||(null===(r=e.to)||void 0===r?void 0:r.includes(n.jid))})),M=function(){var e=Object(O.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.isRoom){e.next=7;break}return e.next=3,t.setRoomAffiliation(n.jid,t.jid,"none");case 3:return e.next=5,t.leaveRoom(n.jid);case 5:e.next=11;break;case 7:return e.next=9,t.removeRosterItem(n.jid);case 9:return e.next=11,t.unsubscribe(n.jid);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),N=function(){if(m){var e=n.isRoom?"groupchat":"chat";t.sendMessage({to:n.jid,body:m,type:e}),x("")}},z=function(){var e=Object(O.a)(b.a.mark((function e(){var r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Oe(a,s);case 2:r=e.sent,console.log("body",r),r.uuid&&t.sendMessage({to:n.jid,body:r.uuid,type:"meeting-invite"});case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=Object(O.a)(b.a.mark((function e(r){var c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getRoomMembers(n.jid);case 2:c=e.sent,p(c.muc.users.map((function(e){var t;return Object(l.a)(Object(l.a)({},e),{},{name:null===(t=o.find((function(t){return e.jid.includes(t.user_id)})))||void 0===t?void 0:t.name})}))),U(r.target);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),G=function(){return U(null)};return Object(r.useEffect)((function(){var e;S.current.scrollTop=null===S||void 0===S||null===(e=S.current)||void 0===e?void 0:e.scrollHeight}),[E]),Object(P.jsxs)(A.a,{sx:{flexGrow:1},children:[Object(P.jsx)(fe,{client:t,room:n,open:w,close:function(){return y(!1)},allUsers:o}),Object(P.jsxs)(A.a,{direction:"row",sx:{px:2,background:"white",alignItems:"center"},children:[Object(P.jsx)("h2",{children:n.name}),Object(P.jsx)(F.a,{sx:{ml:"auto"},onClick:M,children:Object(P.jsx)(le.a,{fontSize:"inherit"})}),n.isRoom&&Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(F.a,{onClick:L,children:Object(P.jsx)(oe.a,{fontSize:"inherit"})}),Object(P.jsxs)(B.a,{id:"basic-menu",anchorEl:R,open:T,onClose:G,MenuListProps:{"aria-labelledby":"basic-button"},children:[d.map((function(e){return Object(P.jsx)(H.a,{children:e.name},e.jid)})),Object(P.jsx)(D.a,{}),Object(P.jsx)(H.a,{onClick:function(){G(),y(!0)},children:"Add"})]})]}),Object(P.jsx)(F.a,{onClick:z,children:Object(P.jsx)(je.a,{fontSize:"inherit"})})]}),Object(P.jsx)(A.a,{sx:{background:"#eee",flexGrow:1,overflow:"auto",px:"10%"},ref:S,children:E.map((function(e){return Object(P.jsx)(be,{message:e,client:t,isRoom:n.isRoom},e.id)}))}),Object(P.jsx)(A.a,{direction:"row",sx:{p:1},children:Object(P.jsx)(I.a,{onChange:function(e){return x(e.target.value)},value:m,sx:{flexGrow:1},placeholder:"Send a message...",onKeyPress:function(e){return"Enter"===e.key&&N()},InputProps:{endAdornment:Object(P.jsx)(C.a,{onClick:N,children:"Send"})}})})]})},me=function(e){var t=e.open,n=e.close,c=e.add,a=Object(r.useState)(""),s=Object(j.a)(a,2),o=s[0],i=s[1];return Object(P.jsxs)(w.a,{open:t,onClose:n,children:[Object(P.jsx)(y.a,{children:"Add Room"}),Object(P.jsx)(S.a,{children:Object(P.jsx)(I.a,{sx:{width:400,my:1},onChange:function(e){return i(e.target.value)},label:"Room name"})}),Object(P.jsxs)(k.a,{children:[Object(P.jsx)(C.a,{onClick:n,children:"Cancel"}),Object(P.jsx)(C.a,{onClick:function(){c(o),n()},children:"Add"})]})]})},xe=function(e){var t=e.open,n=e.close,c=e.add,a=e.allUsers,s=Object(r.useState)(""),o=Object(j.a)(s,2),i=o[0],u=o[1];return Object(P.jsxs)(w.a,{open:t,onClose:n,children:[Object(P.jsx)(y.a,{children:"Add Contact"}),Object(P.jsx)(S.a,{children:Object(P.jsx)($.a,{sx:{width:400,my:1},onChange:function(e,t){return t&&u(t.id)},options:a.map((function(e){return{label:ve(e),id:e.user_id}})),renderInput:function(e){return Object(P.jsx)(I.a,Object(l.a)(Object(l.a)({},e),{},{label:"User"}))}})}),Object(P.jsxs)(k.a,{children:[Object(P.jsx)(C.a,{onClick:n,children:"Cancel"}),Object(P.jsx)(C.a,{onClick:function(){c(i),n()},children:"Add"})]})]})},ve=function(e){return"".concat(e.user_firstname," ").concat(e.user_lastname," (").concat(e.user_email,")")};function ge(e){var t,n,r;return null===(t=e.name)||void 0===t||null===(n=t.split(" "))||void 0===n||null===(r=n.slice(0,2))||void 0===r?void 0:r.map((function(e){return e.substr(0,1)}))}var we=function(e){var t=e.roster,n=e.messages,c=e.client,a=e.allUsers,s=e.API_BASE,o=e.MUC_LIGHT_HOSTNAME,i=e.jwt,l=Object(r.useState)(""),u=Object(j.a)(l,2),d=u[0],p=u[1],f=Object(r.useState)(null),h=Object(j.a)(f,2),m=h[0],x=h[1],v=Object(r.useState)(!1),w=Object(j.a)(v,2),y=w[0],S=w[1],k=Object(r.useState)(!1),C=Object(j.a)(k,2),_=C[0],E=C[1],N=Object(r.useState)(null),z=Object(j.a)(N,2),L=z[0],D=z[1],W=Boolean(L),K=function(){D(null)},J=function(){var e=Object(O.a)(b.a.mark((function e(t){var n,r,a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=crypto.randomUUID(),r="".concat(n,"@").concat(o),e.next=4,c.joinRoom(r);case 4:a=e.sent,console.log("created room!",a),c.configureRoom(r,{fields:[{name:"roomname",value:t}]});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Y=t.filter((function(e){var t,n;return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(d.toLowerCase()))||(null===(n=e.jid)||void 0===n?void 0:n.includes(d))})),q=m&&n[m.jid]?n[m.jid]:[];return Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(xe,{add:function(e){var t="".concat(e,"@").concat(c.config.server);c.subscribe(t)},close:function(){return S(!1)},open:y,allUsers:a}),Object(P.jsx)(me,{add:J,close:function(){return E(!1)},open:_}),Object(P.jsxs)(ee.a,{className:"scroll-list-container",sx:{width:300},children:[Object(P.jsxs)(g.a,{sx:{px:2},children:[Object(P.jsxs)(A.a,{direction:"row",sx:{alignItems:"center"},children:[Object(P.jsx)("h2",{children:"Contacts"}),Object(P.jsx)(F.a,{sx:{ml:"auto"},onClick:function(e){D(e.currentTarget)},children:Object(P.jsx)(re.a,{fontSize:"inherit"})}),Object(P.jsxs)(B.a,{id:"basic-menu",anchorEl:L,open:W,onClose:K,MenuListProps:{"aria-labelledby":"basic-button"},children:[Object(P.jsx)(H.a,{onClick:function(){K(),S(!0)},children:"Add Contact"}),Object(P.jsx)(H.a,{onClick:function(){K(),E(!0)},children:"Add Room"})]})]}),Object(P.jsx)(I.a,{type:"search",label:"Search",variant:"filled",size:"small",fullWidth:!0,onChange:function(e){return p(e.target.value)}})]}),Object(P.jsx)(R.a,{className:"scroll-list",children:Y.map((function(e){var t;return Object(P.jsx)(U.a,{disablePadding:!0,children:Object(P.jsxs)(T.a,{onClick:function(){return x(e)},children:[Object(P.jsx)(te.a,{children:Object(P.jsx)(G.a,{children:e.isRoom?Object(P.jsx)(ae.a,{}):ge(e)})}),Object(P.jsx)(M.a,{primary:e.name,primaryTypographyProps:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},secondary:null===(t=e.user)||void 0===t?void 0:t.user_email,secondaryTypographyProps:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},title:e.jid})]})},e.jid)}))})]}),Object(P.jsx)(ee.a,{className:"right-section",children:m&&Object(P.jsx)(he,{allUsers:a,client:c,user:m,messages:q,API_BASE:s,jwt:i})})]})};function ye(e){var t,n,r;return null===(t=e.name)||void 0===t||null===(n=t.split(" "))||void 0===n||null===(r=n.slice(0,2))||void 0===r?void 0:r.map((function(e){return e.substr(0,1)}))}var Se=function(e){var t=e.client,n=e.allUsers,c=e.roster,a=e.messages,s=e.jwt,o=e.API_BASE,i=Object(r.useState)(""),l=Object(j.a)(i,2),u=l[0],d=l[1],b=Object(r.useState)(null),O=Object(j.a)(b,2),p=O[0],f=O[1];console.log("messages",a);var h=Object.entries(a).map((function(e){var t,r=Object(j.a)(e,2),a=r[0],s=r[1],o=n.find((function(e){return a.includes(e.user_id)})),i=(null===o||void 0===o?void 0:o.name)||(null===(t=c.find((function(e){return e.jid===a})))||void 0===t?void 0:t.name);return{jid:a,user:o,name:i,messages:s}})).filter((function(e){var t,n,r,c,a,s=u.toLowerCase();return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(s))||s.includes(null===(n=e.name)||void 0===n?void 0:n.toLowerCase())||(null===(r=e.user)||void 0===r||null===(c=r.user_email)||void 0===c?void 0:c.includes(s))||s.includes(null===(a=e.user)||void 0===a?void 0:a.user_email)})),m=p&&a[p.jid]?a[p.jid]:[];return Object(P.jsxs)(P.Fragment,{children:[Object(P.jsxs)(ee.a,{className:"scroll-list-container",sx:{width:300},children:[Object(P.jsxs)(g.a,{sx:{px:2},children:[Object(P.jsx)(A.a,{direction:"row",sx:{alignItems:"center"},children:Object(P.jsx)("h2",{children:"Chat"})}),Object(P.jsx)(I.a,{type:"search",label:"Search",variant:"filled",size:"small",fullWidth:!0,onChange:function(e){return d(e.target.value)}})]}),Object(P.jsx)(R.a,{className:"scroll-list",children:h.map((function(e){var t;return Object(P.jsx)(U.a,{disablePadding:!0,children:Object(P.jsxs)(T.a,{onClick:function(){return f(e)},children:[Object(P.jsx)(te.a,{children:Object(P.jsx)(G.a,{children:e.isRoom?Object(P.jsx)(ae.a,{}):ye(e)})}),Object(P.jsx)(M.a,{primary:e.name,primaryTypographyProps:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},secondary:null===(t=e.user)||void 0===t?void 0:t.user_email,secondaryTypographyProps:{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},title:e.jid})]})},e.jid)}))})]}),Object(P.jsx)(ee.a,{className:"right-section",children:p&&Object(P.jsx)(he,{allUsers:n,client:t,user:p,messages:m,API_BASE:o,jwt:s})})]})},ke="https://saas-api.visionable.one";f.default.configure({Auth:{region:"us-east-1",userPoolId:"us-east-1_ESYPvGhN3",userPoolWebClientId:"5ai2feek1rgpso497om1kbj4ug"}});var Ce=localStorage.getItem("xmpp-resource")||crypto.randomUUID();localStorage.setItem("xmpp-resource",Ce);var Ae=function(){var e=Object(O.a)(b.a.mark((function e(t,n,r){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",p.a({jid:t,password:n,resource:Ce,transports:{websocket:"".concat("wss","://").concat(r,":").concat("5443","/").concat("ws-xmpp")}}));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Ie=function(e){var t=e.accept,n=e.reject,r=e.invites,c=e.responses;return r.filter((function(e){return!c[e.id]})).map((function(e){return Object(P.jsxs)(w.a,{open:!0,children:[Object(P.jsx)(y.a,{children:"Meeting Invite"}),Object(P.jsxs)(S.a,{children:[Object(P.jsxs)("p",{children:["Invite ID: ",e.id]}),Object(P.jsxs)("p",{children:["From: ",e.from]}),Object(P.jsxs)("p",{children:["Meeting ID: ",e.body]})]}),Object(P.jsxs)(k.a,{children:[Object(P.jsx)(C.a,{color:"error",onClick:function(){return n(e)},children:"Reject"}),Object(P.jsx)(C.a,{onClick:function(){return t(e)},children:"Accept"})]})]},e.id)}))},Pe=function(){var e=Object(O.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(ke,"/api/user"),{headers:{Authorization:t}});case 2:return n=e.sent,e.abrupt("return",n.ok?n.json():[]);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function _e(e){return(null===e||void 0===e?void 0:e.name)?e.name:(null===e||void 0===e?void 0:e.user_displayname)?e.user_displayname:(null===e||void 0===e?void 0:e.user_firstname)?"".concat(e.user_firstname," ").concat(e.user_lastname):"[No Name]"}function Re(e){return Ue.apply(this,arguments)}function Ue(){return(Ue=Object(O.a)(b.a.mark((function e(t){var n,r,c,a,s=arguments;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:"",e.next=3,t.searchHistory({paging:{after:n}});case 3:r=e.sent,c=r.complete,a=r.paging.last,c||Re(t,a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Te=function(){var e=Object(r.useState)(null),t=Object(j.a)(e,2),n=t[0],c=t[1],a=Object(r.useState)(localStorage.getItem("username")||""),s=Object(j.a)(a,2),d=s[0],p=s[1],f=Object(r.useState)("Green12345!"),w=Object(j.a)(f,2),y=w[0],S=w[1],k=Object(r.useState)(""),C=Object(j.a)(k,2),A=(C[0],C[1]),I=Object(r.useState)(""),R=Object(j.a)(I,2),U=R[0],T=R[1],E=Object(r.useState)(!1),M=Object(j.a)(E,2),N=M[0],z=M[1],L=Object(r.useState)([]),G=Object(j.a)(L,2),B=G[0],H=G[1],D=Object(r.useState)({}),F=Object(j.a)(D,2),W=F[0],K=F[1],J=Object(r.useState)([]),Y=Object(j.a)(J,2),q=Y[0],Q=Y[1],V=Object(r.useState)({}),X=Object(j.a)(V,2),$=X[0],ee=X[1],te=Object(r.useState)(!1),ne=Object(j.a)(te,2),re=ne[0],ce=ne[1],ae=Object(r.useState)(null),se=Object(j.a)(ae,2),oe=se[0],ie=se[1],le=Object(r.useState)([]),ue=Object(j.a)(le,2),je=ue[0],de=ue[1],be=Object(r.useState)("contacts"),Oe=Object(j.a)(be,2),pe=Oe[0],fe=Oe[1],he=Object(r.useState)({}),me=Object(j.a)(he,2),xe=me[0],ve=me[1],ge=Object(r.useState)({}),ye=Object(j.a)(ge,2),Ce=(ye[0],ye[1]),Ue=Object(r.useState)(!1),Te=Object(j.a)(Ue,2),Ee=Te[0],Me=Te[1],Ne=Object(r.useState)("saas.visionable.one"),ze=Object(j.a)(Ne,2),Le=ze[0],Ge=ze[1],Be=Object(r.useState)({}),He=Object(j.a)(Be,2),De=He[0];He[1];Object(r.useEffect)((function(){Object(O.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()}),[Le]);var Fe=Le.split(/\.([\s\S]*)/),We=Object(u.a)(Fe),Ke=We[0],Je=Object(j.a)(We.slice(1),1)[0],Ye="".concat(Ke,"-msg.").concat(Je),qe="muclight.".concat(Ye);console.log(Ke,Je,Ye,qe);var Qe=function(){var e=Object(O.a)(b.a.mark((function e(){var t,r,a,s,u,p,f,m;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ie(""),ce(!0),localStorage.setItem("username",d),console.log("config",De),e.prev=4,e.next=7,h.a.signIn(d,y);case 7:return t=e.sent,r=t.username,a=t.signInUserSession,window.Auth=h.a,s=a.idToken.jwtToken,T(s),u="".concat(r,"@").concat(Ye),A(u),e.next=17,Ae(u,s,Ye);case 17:return p=e.sent,console.log(u,s),c(p),ce(!1),Me(!0),e.next=24,Pe(s);case 24:f=e.sent,m=f.map((function(e){return Object(l.a)(Object(l.a)({},e),{},{name:_e(e)})})),de(m),window.client=p,p.on("session:started",Object(O.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p.sendPresence(),p.enableKeepAlive(),p.enableCarbons(),z(!0),e.next=6,p.getRoster();case 6:t=e.sent.items,H(t),ve({}),Ce({}),Re(p);case 11:case"end":return e.stop()}}),e)})))),p.on("message",(function(e){if("meeting-invite"===e.type)Q((function(t){return[].concat(Object(i.a)(t),[e])}));else if("chat"===e.type){console.log("GOT THE MESSAGE",e);var t=e.from.split("/"),n=Object(j.a)(t,1)[0];ve((function(t){return Object(l.a)(Object(l.a)({},t),{},Object(o.a)({},n,[].concat(Object(i.a)(t[n]||[]),[e])))}))}else if("groupchat"===e.type){var r=e.from.split("/"),c=Object(j.a)(r,2),a=c[0],s=c[1];console.log("GOT A GROUPCHAT",a,s),ve((function(t){return Object(l.a)(Object(l.a)({},t),{},Object(o.a)({},a,[].concat(Object(i.a)(t[a]||[]),[e])))}))}})),p.on("message:sent",(function(e){if("meeting-invite"===e.type);else if("chat"===e.type){var t=e.to.split("/"),n=Object(j.a)(t,1)[0];ve((function(t){return Object(l.a)(Object(l.a)({},t),{},Object(o.a)({},n,[].concat(Object(i.a)(t[n]||[]),[e])))}))}else e.type})),p.on("mam:item",(function(e){var t,n,r=null===(t=e.archive)||void 0===t||null===(n=t.item)||void 0===n?void 0:n.message,c=r.to,a=r.from,s=(null===c||void 0===c?void 0:c.includes(p.config.jid))?a:c;if(s){var u=s.split("/"),d=Object(j.a)(u,1)[0];ve((function(e){return Object(l.a)(Object(l.a)({},e),{},Object(o.a)({},d,[].concat(Object(i.a)(e[d]||[]),[r])))}))}else console.log("NO FULL USER",r)})),p.on("subscribe",(function(e){p.acceptSubscription(e.from)})),p.on("unsubscribe",(function(e){})),p.on("roster:update",function(){var e=Object(O.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.roster.items.forEach((function(e){ve((function(t){return Object(l.a)(Object(l.a)({},t),{},Object(o.a)({},e.jid,[]))})),p.searchHistory({with:e.jid,paging:{before:""}})})),e.t0=H,e.next=4,p.getRoster();case 4:e.t1=e.sent.items,(0,e.t0)(e.t1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),p.on("muc:invite",(function(e){n.joinRoom(e.room)})),p.on("muc:available",Object(O.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=H,e.next=3,p.getRoster();case 3:return e.t1=e.sent.items,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))),p.on("muc:unavailable",Object(O.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=H,e.next=3,p.getRoster();case 3:return e.t1=e.sent.items,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e)})))),p.on("presence",(function(e){K((function(t){return Object(l.a)(Object(l.a)({},t),{},Object(o.a)({},e.from,e))}))})),p.on("*",function(){var e=Object(O.a)(b.a.mark((function e(t,n){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(t,n);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),p.on("disconnected",(function(){Me(!1)})),p.on("connected",(function(){Me(!0)})),p.connect(),e.next=50;break;case 45:e.prev=45,e.t0=e.catch(4),console.error("caught",e.t0),ce(!1),ie(e.t0.message);case 50:case"end":return e.stop()}}),e,null,[[4,45]])})));return function(){return e.apply(this,arguments)}}();Object(r.useEffect)((function(){m.a.listen("auth",function(){var e=Object(O.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"tokenRefresh"===t.payload.event&&console.log("token refreshed",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]),console.log("new presence list",W);var Ve=B.map((function(e){var t,n,r=je.find((function(t){return e.jid.includes(t.user_id)})),c=e.name?e.name:r?_e(r):e.jid,a=Object.values(W).filter((function(t){return t.from.includes(e.jid)})).map((function(e){var t;return null===(t=e.from.split("/"))||void 0===t?void 0:t[1]}));return Object(l.a)(Object(l.a)({},e),{},{user:r,name:c,resources:a,isRoom:!!(null===(t=e.groups)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.includes("muc"))})}));console.log("extended roster",Ve);var Xe=je.find((function(e){return n.jid.match(e.user_id)})),Ze=function(){var e=Object(O.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.currentSession();case 2:n.config.credentials.password=e.sent.idToken.jwtToken,n.connect();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),$e=function(){var e=Object(O.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.disconnect(),z(!1),Me(!1),H([]),K({}),ve({}),Ce({}),e.prev=7,e.next=10,h.a.signOut();case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(7),console.log("error signing out: ",e.t0);case 15:case"end":return e.stop()}}),e,null,[[7,12]])})));return function(){return e.apply(this,arguments)}}();return N?Object(P.jsxs)("div",{className:"App",children:[Object(P.jsx)(Z,{nav:pe,setNav:fe,signOut:$e,client:n,me:Xe}),Object(P.jsx)(x.a,{onClick:Ze,open:!Ee,anchorOrigin:{horizontal:"center",vertical:"bottom"},sx:{cursor:"pointer"},children:Object(P.jsx)(v.a,{severity:"error",sx:{width:"100%"},children:"Disconnected. Click here to reconnect"})}),Object(P.jsx)(Ie,{accept:function(e){ee((function(t){return Object(l.a)(Object(l.a)({},t),{},Object(o.a)({},e.id,"accept"))})),n.sendMessage({to:e.from,body:e.id,type:"meeting-invite-accept"})},reject:function(e){ee((function(t){return Object(l.a)(Object(l.a)({},t),{},Object(o.a)({},e.id,"reject"))})),n.sendMessage({to:e.from,body:e.id,type:"meeting-invite-reject"})},invites:q,responses:$}),Object(P.jsx)(g.a,{className:"main",children:"contacts"===pe?Object(P.jsx)(we,{roster:Ve,messages:xe,allUsers:je,client:n,API_BASE:ke,MUC_LIGHT_HOSTNAME:qe,jwt:U}):"messages"===pe?Object(P.jsx)(Se,{roster:Ve,messages:xe,allUsers:je,client:n,API_BASE:ke,MUC_LIGHT_HOSTNAME:qe,jwt:U}):null})]}):Object(P.jsx)("div",{className:"App",children:Object(P.jsx)(_,{loading:re,username:d,onChangeUsername:function(e){p(e.target.value),ie(null)},password:y,onChangePassword:function(e){S(e.target.value),ie(null)},error:oe,signIn:Qe,server:Le,onChangeServer:function(e){Ge(e.target.value),ie(null)}})})},Ee=n(427);s.a.render(Object(P.jsxs)(c.a.StrictMode,{children:[Object(P.jsx)(Ee.a,{}),Object(P.jsx)(Te,{})]}),document.getElementById("root"))}},[[334,1,2]]]);
//# sourceMappingURL=main.c577636b.chunk.js.map